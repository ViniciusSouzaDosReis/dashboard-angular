<p-dialog
  [(visible)]="displayModal"
  (onHide)="onHide()"
  [style]="{ width: '600px' }"
  header="Criar Associação"
  [modal]="true"
  styleClass="p-fluid"
  [draggable]="false"
  [resizable]="false"
>
  <ng-template pTemplate="header">
    <div class="space-y-1.5">
      <h3 class="text-xl font-semibold">Criar Associação</h3>
      <p class="text-sm text-zinc-400">
        O cliente ja esta associado a 4 planos
      </p>
    </div>
  </ng-template>
  <div class="border p-3 rounded mb-4 space-y-1">
    <span class="font-semibold">Cliente Selecionado</span>
    <div class="flex gap-4 items-center">
      <div
        class="bg-gradient-to-r rounded-full from-zinc-700 size-8 to-zinc-500"
      ></div>
      <div class="">
        <p class="font-medium">{{ user.name }}</p>
        <p class="text-xs text-zinc-400">{{ user.email }}</p>
      </div>
    </div>
  </div>
  <div>
    <p-iconField iconPosition="left">
      <p-inputIcon styleClass="pi pi-search" />
      <input
        (input)="handleSearchUser($event)"
        type="text"
        pInputText
        placeholder="Buscar plano..."
        class="w-full"
        aria-describedby="amount-user"
      />
    </p-iconField>
    @if(plans){
    <div class="flex justify-between items-center mt-2">
      <small class="text-zinc-400" id="amount-user">
        {{ plans.length }} planos encontrados
      </small>
      <small class="text-zinc-400" id="amount-user">
        {{ selectedPlans.length }} planos selecionados
      </small>
    </div>
    } @else {
    <p-skeleton width="150px" height="16px" styleClass="mt-2"></p-skeleton>
    }

    <div class="mt-2">
      <p-scroller
        [items]="plans"
        [itemSize]="60"
        [style]="{ width: '100%', height: '200px' }"
        styleClass="w-full"
      >
        <ng-template pTemplate="item" let-plan let-options="options">
          <div
            class="flex justify-between p-2 rounded-md cursor-pointer hover:bg-zinc-800/50 items-start mb-2"
            [ngClass]="{
              'cursor-not-allowed': isAssociating(plan),
              'bg-zinc-700': isSelected(plan),
              'hover:bg-zinc-600/50': isSelected(plan)
            }"
            (click)="selectPlan(plan)"
          >
            <div>
              <p class="font-medium">{{ plan.name }}</p>
              <p class="text-xs text-zinc-400">{{ plan.name }}</p>
            </div>

            @if(isAssociating(plan)){
            <div class="border rounded-full text-xs px-3">Associado</div>
            }
          </div>
        </ng-template>
      </p-scroller>

      <button
        pButton
        type="button"
        label="Associar"
        (click)="onSubmit()"
        [disabled]="selectedPlans.length === 0"
      ></button>
    </div>
  </div>
</p-dialog>
